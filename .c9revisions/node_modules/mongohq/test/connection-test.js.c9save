{"ts":1352597907792,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var vows      = require('vows'),\n    assert    = require('assert'),\n    mongohq  = require('../lib/mongohq'),\n    base      = require('../lib/mongohq/base'),\n    connection = require('../lib/mongohq/connection');\n\nvows.describe('Connections').addBatch({\n  'when not authenticated': {\n    topic: base,\n    'cannot create a connection': {\n      'is not null': function (topic) {\n        assert.throws( function() {topic.connection()}, 'apikey must be set' )\n      },\n    }\n  }\n\n}).addBatch({\n  'when authenticating': {\n    topic: function () {\n      return mongohq.authenticate({'apikey' : 'derp'});\n    },\n\n    'return the mongohq plugin': {\n      'is not null': function (topic) {\n        assert.isNotNull(topic);\n      },\n      'is able to re-authenticate': function (topic) {\n        assert.isNotNull(topic.authenticate);\n      }\n    }\n  }\n}).addBatch({\n\n  'when making a call': {\n    topic: function () {\n      mongohq.authenticate({'apikey' : 'derp'});\n      mongohq.conn = {'request' : function(){console.log('called')}}\n      return base.connection();\n    },\n\n    'accepts only path': function (topic) {\n      assert.doesNotThrow( function() {topic.call('/')}, Error )\n    },\n\n    'accepts only path and method': function (topic) {\n      assert.doesNotThrow( function() {topic.call('/', 'GET')}, Error )\n    },\n\n    'accepts only path, method, and query': function (topic) {\n      assert.doesNotThrow( function() {topic.call('/', 'GET', {'herp' : 'derp'})}, Error )\n    }\n  },\n\n  'when making a callback': {\n    topic: function () {\n      mongohq.authenticate({'apikey' : 'derp'});\n      mongohq.conn = {'request' : function(opts, callback){ assert(false); }}\n      return base.connection();\n    },\n\n    'accepts callback': function (topic) {\n      topic.call('/', 'GET', {}, function(){\n        assert(true)\n      })\n    }\n  }\n}).export(module);\n\n"]],"start1":0,"start2":0,"length1":0,"length2":1854}]],"length":1854}
